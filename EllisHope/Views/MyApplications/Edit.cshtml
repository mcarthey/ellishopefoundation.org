@model EllisHope.Areas.Admin.Models.ApplicationEditViewModel

@{
    ViewData["Title"] = $"Edit Application #{Model.Id}";
    var currentStep = Model.CurrentStep;
}

<style>
    .edit-container {
        padding-top: 6rem;
    }
    .required::after {
        content: " *";
        color: red;
    }
    
    /* Progress step links */
    .row a[href*="step="] {
        transition: transform 0.2s;
        cursor: pointer;
    }
    
    .row a[href*="step="]:not([style*="pointer-events"]):hover {
        transform: scale(1.1);
    }
    
    .row a[style*="pointer-events: none"] {
        cursor: not-allowed;
        opacity: 0.5;
    }
    
    .row a[href*="step="] i {
        font-size: 1.5rem;
    }
</style>

<div class="container my-5 edit-container">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2>
                        <i class="bi bi-pencil"></i> Edit Application #@Model.Id
                        <span class="badge bg-secondary">Draft</span>
                    </h2>
                </div>
                <div>
                    <button type="submit" form="editForm" name="SaveAndExit" value="true" class="btn btn-outline-secondary">
                        <i class="bi bi-save"></i> Save & Exit
                    </button>
                </div>
            </div>

            <!-- Progress Indicator -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-primary" role="progressbar" 
                             style="width: @((currentStep / 6.0 * 100))%;" 
                             aria-valuenow="@currentStep" aria-valuemin="0" aria-valuemax="6">
                            Step @currentStep of 6
                        </div>
                    </div>
                    <div class="row mt-3 text-center">
                        <div class="col">
                            @{
                                var step1Complete = !string.IsNullOrEmpty(Model.FirstName) && 
                                                   !string.IsNullOrEmpty(Model.LastName) && 
                                                   !string.IsNullOrEmpty(Model.Email) && 
                                                   !string.IsNullOrEmpty(Model.PhoneNumber);
                                var step1Class = currentStep == 1 ? "text-primary fw-bold" : 
                                                step1Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 1 })" 
                               class="btn btn-link p-0 text-decoration-none @step1Class"
                               @(step1Complete || currentStep == 1 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-person@(step1Complete ? "-check-fill" : "")"></i><br/>
                                <small>Personal</small>
                            </a>
                        </div>
                        <div class="col">
                            @{
                                var step2Complete = Model.FundingTypesRequested.Any();
                                var step2Class = currentStep == 2 ? "text-primary fw-bold" : 
                                                step2Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 2 })" 
                               class="btn btn-link p-0 text-decoration-none @step2Class"
                               @(step2Complete || currentStep <= 2 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-cash@(step2Complete ? "-coin" : "")"></i><br/>
                                <small>Funding</small>
                            </a>
                        </div>
                        <div class="col">
                            @{
                                var step3Complete = !string.IsNullOrEmpty(Model.PersonalStatement) && 
                                                   !string.IsNullOrEmpty(Model.ExpectedBenefits) && 
                                                   !string.IsNullOrEmpty(Model.CommitmentStatement);
                                var step3Class = currentStep == 3 ? "text-primary fw-bold" : 
                                                step3Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 3 })" 
                               class="btn btn-link p-0 text-decoration-none @step3Class"
                               @(step3Complete || currentStep <= 3 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-heart@(step3Complete ? "-fill" : "")"></i><br/>
                                <small>Motivation</small>
                            </a>
                        </div>
                        <div class="col">
                            @{
                                var step4Complete = !string.IsNullOrEmpty(Model.FitnessGoals) || 
                                                   !string.IsNullOrEmpty(Model.MedicalConditions);
                                var step4Class = currentStep == 4 ? "text-primary fw-bold" : 
                                                step4Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 4 })" 
                               class="btn btn-link p-0 text-decoration-none @step4Class"
                               @(step4Complete || currentStep <= 4 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-activity"></i><br/>
                                <small>Health</small>
                            </a>
                        </div>
                        <div class="col">
                            @{
                                var step5Complete = Model.UnderstandsCommitment;
                                var step5Class = currentStep == 5 ? "text-primary fw-bold" : 
                                                step5Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 5 })" 
                               class="btn btn-link p-0 text-decoration-none @step5Class"
                               @(step5Complete || currentStep <= 5 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-check2@(step5Complete ? "-circle" : "-square")"></i><br/>
                                <small>Agreement</small>
                            </a>
                        </div>
                        <div class="col">
                            @{
                                var step6Complete = !string.IsNullOrEmpty(Model.Signature);
                                var step6Class = currentStep == 6 ? "text-primary fw-bold" : 
                                                step6Complete ? "text-success fw-bold" : "text-muted";
                            }
                            <a href="@Url.Action("Edit", new { id = Model.Id, step = 6 })" 
                               class="btn btn-link p-0 text-decoration-none @step6Class"
                               @(step6Complete || currentStep <= 6 ? "" : "onclick='return false;' style='pointer-events: none;'")>
                                <i class="bi bi-pen@(step6Complete ? "-fill" : "")"></i><br/>
                                <small>Signature</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Application Form -->
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        @if (currentStep == 1) { <text>Step 1: Personal Information</text> }
                        @if (currentStep == 2) { <text>Step 2: Program Interest & Funding</text> }
                        @if (currentStep == 3) { <text>Step 3: Motivation & Commitment</text> }
                        @if (currentStep == 4) { <text>Step 4: Health & Fitness</text> }
                        @if (currentStep == 5) { <text>Step 5: Program Requirements</text> }
                        @if (currentStep == 6) { <text>Step 6: Review & Sign</text> }
                    </h3>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" asp-route-id="@Model.Id" method="post" id="editForm">
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="CurrentStep" />
                        <input type="hidden" asp-for="Status" />
                        
                        @* Hidden fields to preserve data from ALL steps *@
                        @* Only include if not on current step AND data exists *@
                        @if (currentStep != 1)
                        {
                            <input type="hidden" asp-for="FirstName" />
                            <input type="hidden" asp-for="LastName" />
                            <input type="hidden" asp-for="PhoneNumber" />
                            <input type="hidden" asp-for="Email" />
                            <input type="hidden" asp-for="Address" />
                            <input type="hidden" asp-for="City" />
                            <input type="hidden" asp-for="State" />
                            <input type="hidden" asp-for="ZipCode" />
                            <input type="hidden" asp-for="Occupation" />
                            <input type="hidden" asp-for="DateOfBirth" />
                            <input type="hidden" asp-for="EmergencyContactName" />
                            <input type="hidden" asp-for="EmergencyContactPhone" />
                        }
                        
                        @if (currentStep != 2 && Model.FundingTypesRequested.Any())
                        {
                            @foreach (var fundingType in Model.FundingTypesRequested)
                            {
                                <input type="hidden" name="FundingTypesRequested" value="@fundingType" />
                            }
                            <input type="hidden" asp-for="EstimatedMonthlyCost" />
                            <input type="hidden" asp-for="ProgramDurationMonths" />
                            <input type="hidden" asp-for="FundingDetails" />
                        }
                        
                        @* Only include Step 3 if PersonalStatement exists *@
                        @if (currentStep != 3 && !string.IsNullOrEmpty(Model.PersonalStatement))
                        {
                            <input type="hidden" asp-for="PersonalStatement" />
                            <input type="hidden" asp-for="ExpectedBenefits" />
                            <input type="hidden" asp-for="CommitmentStatement" />
                            <input type="hidden" asp-for="ConcernsObstacles" />
                        }
                        
                        @* Only include Step 4 if any health data exists *@
                        @if (currentStep != 4 && (!string.IsNullOrEmpty(Model.MedicalConditions) || !string.IsNullOrEmpty(Model.FitnessGoals)))
                        {
                            <input type="hidden" asp-for="MedicalConditions" />
                            <input type="hidden" asp-for="CurrentMedications" />
                            <input type="hidden" asp-for="LastPhysicalExamDate" />
                            <input type="hidden" asp-for="FitnessGoals" />
                            <input type="hidden" asp-for="CurrentFitnessLevel" />
                        }
                        
                        @* Only include Step 5 if any agreements exist *@
                        @if (currentStep != 5 && (Model.UnderstandsCommitment || 
                                                   Model.AgreesToNutritionist || 
                                                   Model.AgreesToPersonalTrainer || 
                                                   Model.AgreesToWeeklyCheckIns || 
                                                   Model.AgreesToProgressReports))
                        {
                            <input type="hidden" asp-for="AgreesToNutritionist" />
                            <input type="hidden" asp-for="AgreesToPersonalTrainer" />
                            <input type="hidden" asp-for="AgreesToWeeklyCheckIns" />
                            <input type="hidden" asp-for="AgreesToProgressReports" />
                            <input type="hidden" asp-for="UnderstandsCommitment" />
                        }
                        
                        @* Only include Step 6 if signature exists *@
                        @if (currentStep != 6 && !string.IsNullOrEmpty(Model.Signature))
                        {
                            <input type="hidden" asp-for="Signature" />
                        }
                        
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        @* Step 1: Personal Information *@
                        @if (currentStep == 1)
                        {
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="FirstName" class="form-label required"></label>
                                    <input asp-for="FirstName" class="form-control" />
                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="LastName" class="form-label required"></label>
                                    <input asp-for="LastName" class="form-control" />
                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="Address" class="form-label"></label>
                                <input asp-for="Address" class="form-control" />
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="City" class="form-label"></label>
                                    <input asp-for="City" class="form-control" />
                                    <span asp-validation-for="City" class="text-danger"></span>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label asp-for="State" class="form-label"></label>
                                    <input asp-for="State" class="form-control" maxlength="2" />
                                    <span asp-validation-for="State" class="text-danger"></span>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label asp-for="ZipCode" class="form-label"></label>
                                    <input asp-for="ZipCode" class="form-control" />
                                    <span asp-validation-for="ZipCode" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="PhoneNumber" class="form-label required"></label>
                                    <input asp-for="PhoneNumber" class="form-control" type="tel" />
                                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Email" class="form-label required"></label>
                                    <input asp-for="Email" class="form-control" type="email" />
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Occupation" class="form-label"></label>
                                    <input asp-for="Occupation" class="form-control" />
                                    <span asp-validation-for="Occupation" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="DateOfBirth" class="form-label"></label>
                                    <input asp-for="DateOfBirth" class="form-control" type="date" />
                                    <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="EmergencyContactName" class="form-label"></label>
                                    <input asp-for="EmergencyContactName" class="form-control" />
                                    <span asp-validation-for="EmergencyContactName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="EmergencyContactPhone" class="form-label"></label>
                                    <input asp-for="EmergencyContactPhone" class="form-control" type="tel" />
                                    <span asp-validation-for="EmergencyContactPhone" class="text-danger"></span>
                                </div>
                            </div>
                        }

                        @* Step 2: Program Interest & Funding *@
                        @if (currentStep == 2)
                        {
                            <div class="mb-4">
                                <label class="form-label required">Types of Funding/Support Requested</label>
                                <small class="text-muted d-block mb-2">Select all that apply</small>
                                

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="GymMembership" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.GymMembership) ? "checked" : "") />
                                    <label class="form-check-label">Gym Membership</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="PersonalTraining" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.PersonalTraining) ? "checked" : "") />
                                    <label class="form-check-label">Personal Training</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="NutritionistConsultation" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.NutritionistConsultation) ? "checked" : "") />
                                    <label class="form-check-label">Nutritionist Consultation</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="FitnessEquipment" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.FitnessEquipment) ? "checked" : "") />
                                    <label class="form-check-label">Fitness Equipment</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="FitnessApparel" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.FitnessApparel) ? "checked" : "") />
                                    <label class="form-check-label">Fitness Apparel</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="NutritionSupplements" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.NutritionSupplements) ? "checked" : "") />
                                    <label class="form-check-label">Nutrition Supplements</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="GroupClasses" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.GroupClasses) ? "checked" : "") />
                                    <label class="form-check-label">Group Classes</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="OnlinePrograms" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.OnlinePrograms) ? "checked" : "") />
                                    <label class="form-check-label">Online Programs</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="FundingTypesRequested" value="Other" 
                                           @(Model.FundingTypesRequested.Contains(EllisHope.Models.Domain.FundingType.Other) ? "checked" : "") />
                                    <label class="form-check-label">Other</label>
                                </div>

                                <span asp-validation-for="FundingTypesRequested" class="text-danger"></span>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="EstimatedMonthlyCost" class="form-label"></label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input asp-for="EstimatedMonthlyCost" class="form-control" type="number" step="0.01" />
                                    </div>
                                    <span asp-validation-for="EstimatedMonthlyCost" class="text-danger"></span>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label asp-for="ProgramDurationMonths" class="form-label"></label>
                                    <input asp-for="ProgramDurationMonths" class="form-control" type="number" min="1" max="24" />
                                    <span asp-validation-for="ProgramDurationMonths" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="FundingDetails" class="form-label"></label>
                                <textarea asp-for="FundingDetails" class="form-control" rows="4" 
                                          placeholder="Please provide specific details about your funding needs..."></textarea>
                                <span asp-validation-for="FundingDetails" class="text-danger"></span>
                            </div>
                        }

                        @* Step 3: Motivation & Commitment *@
                        @if (currentStep == 3)
                        {
                            <div class="mb-4">
                                <label asp-for="PersonalStatement" class="form-label required"></label>
                                <small class="text-muted d-block mb-2">Minimum 50 characters</small>
                                <textarea asp-for="PersonalStatement" class="form-control" rows="6" 
                                          placeholder="Tell us about yourself, why you want to be part of this program, and how you could benefit from it..."></textarea>
                                <span asp-validation-for="PersonalStatement" class="text-danger"></span>
                                <small class="text-muted">@(Model.PersonalStatement?.Length ?? 0) characters</small>
                            </div>

                            <div class="mb-4">
                                <label asp-for="ExpectedBenefits" class="form-label required"></label>
                                <small class="text-muted d-block mb-2">Minimum 50 characters</small>
                                <textarea asp-for="ExpectedBenefits" class="form-control" rows="5" 
                                          placeholder="How will this program benefit you?"></textarea>
                                <span asp-validation-for="ExpectedBenefits" class="text-danger"></span>
                                <small class="text-muted">@(Model.ExpectedBenefits?.Length ?? 0) characters</small>
                            </div>

                            <div class="mb-4">
                                <label asp-for="CommitmentStatement" class="form-label required"></label>
                                <small class="text-muted d-block mb-2">Minimum 50 characters - Consider your schedule and travel requirements</small>
                                <textarea asp-for="CommitmentStatement" class="form-control" rows="5" 
                                          placeholder="Are you willing and able to devote the time and energy necessary? List any concerns..."></textarea>
                                <span asp-validation-for="CommitmentStatement" class="text-danger"></span>
                                <small class="text-muted">@(Model.CommitmentStatement?.Length ?? 0) characters</small>
                            </div>

                            <div class="mb-3">
                                <label asp-for="ConcernsObstacles" class="form-label"></label>
                                <textarea asp-for="ConcernsObstacles" class="form-control" rows="4" 
                                          placeholder="List any concerns or obstacles that might affect your participation..."></textarea>
                                <span asp-validation-for="ConcernsObstacles" class="text-danger"></span>
                            </div>
                        }

                        @* Step 4: Health & Fitness *@
                        @if (currentStep == 4)
                        {
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> This information helps us customize the program to your needs. All health information is kept confidential.
                            </div>

                            <div class="mb-3">
                                <label asp-for="MedicalConditions" class="form-label"></label>
                                <textarea asp-for="MedicalConditions" class="form-control" rows="4" 
                                          placeholder="Describe any pre-existing medical conditions you may have..."></textarea>
                                <span asp-validation-for="MedicalConditions" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="CurrentMedications" class="form-label"></label>
                                <textarea asp-for="CurrentMedications" class="form-control" rows="3" 
                                          placeholder="List any medications you are currently taking..."></textarea>
                                <span asp-validation-for="CurrentMedications" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="LastPhysicalExamDate" class="form-label"></label>
                                <input asp-for="LastPhysicalExamDate" class="form-control" type="date" />
                                <span asp-validation-for="LastPhysicalExamDate" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="CurrentFitnessLevel" class="form-label"></label>
                                <select asp-for="CurrentFitnessLevel" class="form-select" asp-items="Html.GetEnumSelectList<EllisHope.Models.Domain.FitnessLevel>()">
                                    <option value="">Select your current fitness level...</option>
                                </select>
                                <span asp-validation-for="CurrentFitnessLevel" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label asp-for="FitnessGoals" class="form-label"></label>
                                <textarea asp-for="FitnessGoals" class="form-control" rows="4" 
                                          placeholder="What are your specific fitness goals?"></textarea>
                                <span asp-validation-for="FitnessGoals" class="text-danger"></span>
                            </div>
                        }

                        @* Step 5: Program Requirements *@
                        @if (currentStep == 5)
                        {
                            <div class="alert alert-warning">
                                <i class="bi bi-exclamation-triangle"></i> Please carefully review and acknowledge the following program requirements.
                            </div>

                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Program Commitments</h5>
                                    

                                    <div class="form-check mb-3">
                                        <input asp-for="AgreesToNutritionist" class="form-check-input" type="checkbox" />
                                        <label asp-for="AgreesToNutritionist" class="form-check-label"></label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input asp-for="AgreesToPersonalTrainer" class="form-check-input" type="checkbox" />
                                        <label asp-for="AgreesToPersonalTrainer" class="form-check-label"></label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input asp-for="AgreesToWeeklyCheckIns" class="form-check-input" type="checkbox" />
                                        <label asp-for="AgreesToWeeklyCheckIns" class="form-check-label"></label>
                                    </div>

                                    <div class="form-check mb-3">
                                        <input asp-for="AgreesToProgressReports" class="form-check-input" type="checkbox" />
                                        <label asp-for="AgreesToProgressReports" class="form-check-label"></label>
                                    </div>

                                    <div class="form-check">
                                        <input asp-for="UnderstandsCommitment" class="form-check-input" type="checkbox" />
                                        <label asp-for="UnderstandsCommitment" class="form-check-label fw-bold text-danger"></label>
                                        <span asp-validation-for="UnderstandsCommitment" class="text-danger d-block"></span>
                                    </div>
                                </div>
                            </div>
                        }

                        @* Step 6: Review & Sign *@
                        @if (currentStep == 6)
                        {
                            <div class="alert alert-success">
                                <i class="bi bi-check-circle"></i> Almost done! Please review your information and sign below.
                            </div>

                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0">Application Summary</h5>
                                </div>
                                <div class="card-body">
                                    <h6>Personal Information</h6>
                                    <p><strong>Name:</strong> @Model.FirstName @Model.LastName<br/>
                                       <strong>Email:</strong> @Model.Email<br/>
                                       <strong>Phone:</strong> @Model.PhoneNumber</p>

                                    <h6 class="mt-3">Funding Request</h6>
                                    <p><strong>Types:</strong> @string.Join(", ", Model.FundingTypesRequested)<br/>
                                       @if (Model.EstimatedMonthlyCost.HasValue)
                                       {
                                           <text><strong>Estimated Cost:</strong> $@Model.EstimatedMonthlyCost.Value.ToString("N2")/month</text>
                                       }</p>

                                    <h6 class="mt-3">Commitment</h6>
                                    <p>
                                        @if (Model.AgreesToNutritionist)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                        <text> Agrees to work with nutritionist</text><br/>
                                        
                                        @if (Model.AgreesToPersonalTrainer)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                        <text> Agrees to work with personal trainer</text><br/>
                                        
                                        @if (Model.AgreesToWeeklyCheckIns)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                        <text> Weekly check-ins</text><br/>
                                        
                                        @if (Model.AgreesToProgressReports)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                        <text> Monthly progress reports</text><br/>
                                        
                                        @if (Model.UnderstandsCommitment)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                        <text> Understands 12-month commitment</text>
                                    </p>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label asp-for="Signature" class="form-label required"></label>
                                <small class="text-muted d-block mb-2">Type your full name as your digital signature</small>
                                <input asp-for="Signature" class="form-control" placeholder="Your Full Name" />
                                <span asp-validation-for="Signature" class="text-danger"></span>
                            </div>

                            <div class="alert alert-info">
                                <i class="bi bi-shield-check"></i> By signing this application, you certify that all information provided is accurate and complete.
                            </div>
                        }

                        @* Navigation Buttons *@
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <!-- Progress Buttons -->
                            <div>
                                @if (currentStep > 1)
                                {
                                    <button type="submit" name="Navigate" value="Previous" class="btn btn-secondary">
                                        <i class="bi bi-arrow-left-circle"></i> Back
                                    </button>
                                }
                            </div>
                            <div>
                                @if (currentStep < 6)
                                {
                                    <button type="submit" name="NextStep" value="true" class="btn btn-primary">
                                        Next <i class="bi bi-arrow-right"></i>
                                    </button>
                                }
                                else
                                {
                                    <button type="submit" name="SubmitApplication" value="true" class="btn btn-success btn-lg">
                                        <i class="bi bi-send-check"></i> Submit Application
                                    </button>
                                }
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Character counter for textareas
        document.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('input', function() {
                const counter = this.parentElement.querySelector('small.text-muted');
                if (counter && counter.textContent.includes('characters')) {
                    counter.textContent = `${this.value.length} characters`;
                }
            });
        });
        
        // Disable client-side validation for "Save & Exit" and "Back" buttons
        // This allows saving incomplete drafts and navigating without validation errors
        const saveExitButton = document.querySelector('button[name="SaveAndExit"]');
        const backButton = document.querySelector('button[name="Navigate"]');
        
        function disableValidation(e) {
            const form = document.getElementById('editForm');
            if (form) {
                form.noValidate = true;
            }
        }
        
        if (saveExitButton) {
            saveExitButton.addEventListener('click', disableValidation);
        }
        
        if (backButton) {
            backButton.addEventListener('click', disableValidation);
        }
    </script>
}
